<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant AI Chatbot Portfolio</title>
    <link rel="stylesheet" href="../main.css/chatbot.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
    <div class="container">
        <button id="unhide-button" class="cta-button" style="display: none;">
            ‚Üê
        </button>
        <div class="header">
            <h1>Friendly Assistant</h1>
            <p>Personalized customer support staff for each restaurant</p>
        </div>

        <div class="Introduction">
            <div class="cta-wrapper">
                <a href="#" class="cta-button" id="start-button">Start Now ‚Üí</a>
            </div>
            <div class="features-title">
                <span class="sparkle">‚ú®</span>
                <span>Key Features</span>
            </div>

            <div class="features-grid">
                <div class="feature-card">
                    <span class="feature-icon">ü§ñ</span>
                    <h3 class="feature-title">Automatic Responses</h3>
                    <p class="feature-description">
                        24/7 customer support, handling hundreds of queries simultaneously with high accuracy
                    </p>
                </div>

                <div class="feature-card">
                    <span class="feature-icon">üìÖ</span>
                    <h3 class="feature-title">Auto Table Booking</h3>
                    <p class="feature-description">
                        Customers can quickly book tables, select time and number of people via chat
                    </p>
                </div>

                <div class="feature-card">
                    <span class="feature-icon">üí∞</span>
                    <h3 class="feature-title">Cost Saving</h3>
                    <p class="feature-description">
                        Reduce 80% of customer service staffing costs, unlimited messages
                    </p>
                </div>

                <div class="feature-card">
                    <span class="feature-icon">üõçÔ∏è</span>
                    <h3 class="feature-title">Product Consultation</h3>
                    <p class="feature-description">
                        Chatbot understands menu, prices, promotions to advise suitable products
                    </p>
                </div>

                <div class="feature-card">
                    <span class="feature-icon">üì±</span>
                    <h3 class="feature-title">Multi-platform</h3>
                    <p class="feature-description">
                        Integrates with Facebook, Zalo, Website, WhatsApp - One chatbot for all sales channels
                    </p>
                </div>

                <div class="feature-card">
                    <span class="feature-icon">üìä</span>
                    <h3 class="feature-title">Analytics Reports</h3>
                    <p class="feature-description">
                        Track performance, analyze customer behavior, optimize business strategy
                    </p>
                </div>
            </div>
        </div>

        <div class="main-content hidden">
            <div class="left-section">
                <div class="restaurant-list">
                    <h2>Select a restaurant</h2>
                    <div class="restaurant-card" onclick="selectRestaurant('golden-dragon')">
                        <div class="restaurant-card-header">
                            <img src="https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=100&h=100&fit=crop&crop=center"
                                alt="Golden Dragon" class="restaurant-avatar">
                            <div class="restaurant-info">
                                <h3>Golden Dragon</h3>
                                <p>Premium Chinese restaurant</p>
                            </div>
                        </div>
                    </div>

                    <div class="restaurant-card" onclick="selectRestaurant('pho-saigon')">
                        <div class="restaurant-card-header">
                            <img src="https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=100&h=100&fit=crop&crop=center"
                                alt="Ph·ªü S√†i G√≤n" class="restaurant-avatar">
                            <div class="restaurant-info">
                                <h3>Saigon Pho</h3>
                                <p>Traditional Vietnamese Pho</p>
                            </div>
                        </div>
                    </div>

                    <div class="restaurant-card" onclick="selectRestaurant('italian-corner')">
                        <div class="restaurant-card-header">
                            <img src="https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=100&h=100&fit=crop&crop=center"
                                alt="Italian Corner" class="restaurant-avatar">
                            <div class="restaurant-info">
                                <h3>Italian Corner</h3>
                                <p>Authentic Italian restaurant</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-section" id="info-section">
                    <h3 id="info-title">Restaurant Information</h3>
                    <div class="info-details" id="info-details">
                        Select a restaurant to view details
                    </div>
                </div>
            </div>

            <div class="chatbox" id="chatbox">
                <div class="chat-header">
                    <img src="" alt="Restaurant" class="chat-avatar" id="chat-avatar">
                    <div>
                        <div class="chat-title" id="chat-title">Select a restaurant</div>
                        <div class="chat-status">Always ready to serve</div>
                    </div>
                </div>

                <div class="chat-messages" id="chat-messages">
                    <div class="message">
                        <img src="" alt="Bot" class="message-avatar">
                        <div class="message-content">
                            Hello! I'm your virtual assistant. Please select a restaurant to start chatting! üëã
                        </div>
                    </div>
                </div>

                <div class="quick-questions">
                    <h4>How can we help you today?</h4>
                    <div class="question-grid">
                        <button class="question-btn" onclick="sendQuickQuestion('I want to book a table')">üçΩÔ∏è Book
                            table</button>
                        <button class="question-btn" onclick="sendQuickQuestion('What's on today's menu?')">üìã View
                            menu</button>
                        <button class="question-btn" onclick="sendQuickQuestion('Opening hours?')">üïê Opening
                            hours</button>
                        <button class="question-btn" onclick="sendQuickQuestion('Restaurant address?')">üìç
                            Address</button>
                    </div>
                </div>

                <div class="chat-input">
                    <input type="text" id="message-input" placeholder="Type your message..."
                        onkeypress="handleKeyPress(event)">
                    <button onclick="sendMessage()">‚û§</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const restaurants = {
            'golden-dragon': {
                name: 'Golden Dragon',
                avatar: 'https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=100&h=100&fit=crop&crop=center',
                info: `<strong>Golden Dragon - Premium Chinese Restaurant</strong><br><br>
                       <strong>Address:</strong> 123 Nguyen Hue Street, District 1, HCMC<br>
                       <strong>Opening hours:</strong> 10:00 - 22:00 (Monday - Sunday)<br>
                       <strong>Phone:</strong> (028) 3822 1234<br>
                       <strong>Specialties:</strong> Peking duck, Dim sum, Yangzhou fried rice<br>
                       <strong>Average price:</strong> 300,000 - 500,000 VND/person<br>
                       <strong>Services:</strong> Advance booking, Private rooms, Wedding parties`,
            },
            'pho-saigon': {
                name: 'Saigon Pho',
                avatar: 'https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=100&h=100&fit=crop&crop=center',
                info: `<strong>Saigon Pho - Traditional Vietnamese Pho</strong><br><br>
                       <strong>Address:</strong> 456 Le Loi Street, District 1, HCMC<br>
                       <strong>Opening hours:</strong> 06:00 - 22:00 (Monday - Sunday)<br>
                       <strong>Phone:</strong> (028) 3829 5678<br>
                       <strong>Specialties:</strong> Beef pho, Chicken pho, Hue beef noodle, Fish cake<br>
                       <strong>Average price:</strong> 50,000 - 120,000 VND/bowl<br>
                       <strong>Services:</strong> Takeaway, Delivery, Online booking`,
            },
            'italian-corner': {
                name: 'Italian Corner',
                avatar: 'https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=100&h=100&fit=crop&crop=center',
                info: `<strong>Italian Corner - Authentic Italian Restaurant</strong><br><br>
                       <strong>Address:</strong> 789 Dong Khoi Street, District 1, HCMC<br>
                       <strong>Opening hours:</strong> 11:00 - 23:00 (Monday - Sunday)<br>
                       <strong>Phone:</strong> (028) 3824 9012<br>
                       <strong>Specialties:</strong> Pizza, Pasta, Risotto, Tiramisu<br>
                       <strong>Average price:</strong> 200,000 - 400,000 VND/person<br>
                       <strong>Services:</strong> Romantic space, Italian wine, Birthday parties`,
            }
        };

        let currentRestaurant = null;

        function selectRestaurant(restaurantId) {
            // Remove active class from all cards
            document.querySelectorAll('.restaurant-card').forEach(card => {
                card.classList.remove('active');
            });

            // Add active class to selected card
            event.currentTarget.classList.add('active');

            currentRestaurant = restaurants[restaurantId];

            // Show restaurant info
            const infoSection = document.getElementById('info-section');
            const infoTitle = document.getElementById('info-title');
            const infoDetails = document.getElementById('info-details');

            infoTitle.textContent = currentRestaurant.name;
            infoDetails.innerHTML = currentRestaurant.info;
            infoSection.classList.add('active');

            // Show chatbox
            const chatbox = document.getElementById('chatbox');
            const chatTitle = document.getElementById('chat-title');
            const chatAvatar = document.getElementById('chat-avatar');
            const chatMessages = document.getElementById('chat-messages');

            chatTitle.textContent = currentRestaurant.name;
            chatAvatar.src = currentRestaurant.avatar;
            chatbox.classList.add('active');

            // Reset chat messages
            chatMessages.innerHTML = `
                <div class="message">
                    <img src="${currentRestaurant.avatar}" alt="Bot" class="message-avatar">
                    <div class="message-content">
                        Hello! I'm the virtual assistant for ${currentRestaurant.name}. How can I help you today? üòä
                    </div>
                </div>
            `;
        }

        function closeInfo() {
            document.getElementById('info-section').classList.remove('active');
        }
        //Create chat ID
        const chatId = generateChatId();

        function generateChatId() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let id = '';
            for (let i = 0; i < 7; i++) {
                id += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return id;
        }
        //send quick question
        function sendQuickQuestion(message) {

            addMessage(message, true);

            const WEBHOOK_URL = 'https://n8n.kpsimple.store/webhook/9c35f315-03c5-4569-8789-ea6d6c8543e2';

            const urlWithParams = `${WEBHOOK_URL}?message=${encodeURIComponent(message)}&restaurant=${encodeURIComponent(currentRestaurant.name || 'golden-dragon')}&chat_id=${encodeURIComponent(chatId)}`;

            fetch(urlWithParams)
                .then(response => {
                    return response.text().then(text => {
                        if (!response.ok) {
                            throw new Error(`Server error (${response.status}): ${text}`);
                        }

                        try {
                            return JSON.parse(text);
                        } catch (parseError) {
                            throw new Error('Server returned invalid data');
                        }
                    });
                })
                .then(data => {
                    let reply = null;

                    if (Array.isArray(data)) {
                        if (data.length > 0 && data[0].reply) {
                            reply = data[0].reply;
                        }
                    } else if (data && data.reply) {
                        reply = data.reply;
                    }

                    if (reply) {
                        addMessage(reply, false);
                    } else {
                        throw new Error('No valid response found from webhook');
                    }
                })
                .catch(error => {
                    console.error('Webhook error:', error);
                    addMessage("Sorry, our system encountered an error. Please try again later.", false);
                });
        }


        function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();

            if (!message) return;
            if (!currentRestaurant) {
                alert('Please select a restaurant first!');
                return;
            }

            addMessage(message, true); // Show user message
            input.value = '';

            const WEBHOOK_URL = 'https://n8n.kpsimple.store/webhook/9c35f315-03c5-4569-8789-ea6d6c8543e2';

            // Send message via query param (GET)
            const urlWithParams = `${WEBHOOK_URL}?message=${encodeURIComponent(message)}&restaurant=${encodeURIComponent(currentRestaurant.name || 'golden-dragon')}&chat_id=${encodeURIComponent(chatId)}`;

            fetch(urlWithParams)
                .then(response => {
                    return response.text().then(text => {
                        if (!response.ok) {
                            throw new Error(`Server error (${response.status}): ${text}`);
                        }

                        try {
                            return JSON.parse(text);
                        } catch (parseError) {
                            throw new Error('Server returned invalid data');
                        }
                    });
                })
                .then(data => {
                    let reply = null;

                    if (Array.isArray(data)) {
                        if (data.length > 0 && data[0].reply) {
                            reply = data[0].reply;
                        }
                    } else if (data && data.reply) {
                        reply = data.reply;
                    }

                    if (reply) {
                        addMessage(reply, false);
                    } else {
                        throw new Error('No valid response found from webhook');
                    }
                })
                .catch(error => {
                    console.error('Webhook error:', error);
                    addMessage("Sorry, our system encountered an error. Please try again later.", false);
                });
            setTimeout(() => {
                let response = 'Thank you for your message! Our team will respond as soon as possible. You can try the common questions below! üòä';

                addMessage(response, false);
            }, 1000);
        }


        function addMessage(message, isUser) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : ''}`;

            const avatar = isUser ? '/Picture/Support.jpg' : currentRestaurant.avatar;

            const content = isUser ? message : marked.parse(message); // Chuy·ªÉn markdown sang HTML n·∫øu l√† bot

            messageDiv.innerHTML = `
            <img src="${avatar}" alt="${isUser ? 'User' : 'Bot'}" class="message-avatar">
            <div class="message-content">${content}</div>
        `;

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        document.getElementById('start-button').addEventListener('click', function (e) {
            e.preventDefault();
            document.querySelector('.Introduction').style.display = 'none';
            document.querySelector('.main-content').classList.remove('hidden');
            document.getElementById('unhide-button').style.display = 'block';
        });

        // N√∫t "‚Üê Quay l·∫°i ph·∫ßn gi·ªõi thi·ªáu"
        document.getElementById('unhide-button').addEventListener('click', function () {
            document.querySelector('.Introduction').style.display = 'block';
            document.querySelector('.main-content').classList.add('hidden');
            this.style.display = 'none';
        });
    </script>
</body>

</html>
